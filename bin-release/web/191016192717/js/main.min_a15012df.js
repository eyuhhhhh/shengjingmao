var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(a,r){function o(t){try{l(i.next(t))}catch(e){r(e)}}function s(t){try{l(i["throw"](t))}catch(e){r(e)}}function l(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(o,s)}l((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,r&&(o=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,r=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=e.call(t,l)}catch(i){n=[6,i],r=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,r,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},Cat=function(t){function e(){var e=t.call(this)||this;e.isnormal=!0;var n=RES.getRes("cat_normal_json"),i=RES.getRes("cat_normal_png");return e.bg=new egret.MovieClip,e.mcF=new egret.MovieClipDataFactory(n,i),e.mc=new egret.MovieClip(e.mcF.generateMovieClipData("cat_normal")),e.bg.movieClipData=e.mc.movieClipData,n=RES.getRes("cat_loser_json"),i=RES.getRes("cat_loser_png"),e.bg2=new egret.MovieClip,e.mcF=new egret.MovieClipDataFactory(n,i),e.mc=new egret.MovieClip(e.mcF.generateMovieClipData("cat_loser")),e.bg2.movieClipData=e.mc.movieClipData,e.playmc(),e}return __extends(e,t),e.prototype.init=function(){this.isnormal=!0,this.playmc()},e.prototype.playmc=function(){this.numChildren&&this.removeChildAt(0),this.isnormal?(this.bg.play(-1),this.addChild(this.bg)):(this.bg2.play(-1),this.addChild(this.bg2))},Object.defineProperty(e.prototype,"isnormalmc",{get:function(){return this.isnormal},set:function(t){this.isnormal!==t&&(this.isnormal=t,this.playmc())},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(Cat.prototype,"Cat");var GameEvent=function(t){function e(e,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1);var a=t.call(this,e,n,i)||this;return a.opren_tile_index=0,a}return __extends(e,t),e.OPEN_TILE="open_tile",e.START_GAME="start_game",e}(egret.Event);__reflect(GameEvent.prototype,"GameEvent");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,RES.loadGroup("gameres",0,t)];case 2:return n.sent(),this.stage.removeChild(t),[3,4];case 3:return e=n.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){this.viewnanage=new ViewManage(this,RES.getRes("gameres_json")),this.viewnanage.addEventListener(GameEvent.START_GAME,this.startGame,this),this.viewnanage.addEventListener(GameEvent.OPEN_TILE,this.openTile,this)},e.prototype.startGame=function(){DataManage.instance().init_tileDatas(),DataManage.instance().selectTile(),DataManage.instance().createCatPoint(),this.viewnanage.updateAll()},e.prototype.openTile=function(t){DataManage.instance().stepNum++,DataManage.instance().closeTileByIndex(t.opren_tile_index);var e=DataManage.instance().isHaveNextPointByCat();e?this.viewnanage.update():this.viewnanage.showGameOverView(DataManage.instance()._isS)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var Util=function(){function t(){}return t.getPointByIndex=function(t){var e=new egret.Point;return e.x=t%9,e.y=Math.floor(t/9),e},t.getPointXYByIndex=function(t){var e=new egret.Point,n=0;return Math.floor(t/9)%2==1&&(n=25),e.x=100+50*(t%9)+n,e.y=500+50*Math.floor(t/9),e},t.getIndexByPoint=function(t){var e=9*t.y+t.x;return e},t}();__reflect(Util.prototype,"Util");var CatAi=function(){function t(){}return t.prototype.findPath=function(t){for(var e,n,i=[t],a=[],r=0,o=!0;o;){if(0==i.length)return o=!1,null;for(var s=[],l=i.length,h=0;l>h;h++){e=i.shift(),n=this.findRound(e),r=n.length;for(var c=0;r>c;c++)if(this.map[n[c]]._isUsed&&a.push(n[c]),!(a.indexOf(n[c])>-1||i.indexOf(n[c])>-1)){if(this.map[n[c]].preIndex=e,this.isExit(n[c]))return n[c];s.push(n[c])}a.push(e)}i=s}},t.prototype.findNextPoint=function(t){this.initMap();var e=this.findPath(t);if(console.log(e),null==e)return null;if(-1==e)return-1;for(var n,i=!0;i;)n=this.map[e].preIndex,DataManage.instance().setberfore(n),n!=t&&-1!=n?e=n:i=!1;return e},t.prototype.isExit=function(t){var e=Util.getPointByIndex(t);return 0==e.y||8==e.y||0==e.x||8==e.x?!0:!1},t.prototype.getNear=function(t){var e=this.findRound(t);return e[0]},t.prototype.initMap=function(){if(null==this.map){this.map=[];for(var t=0;81>t;t++)this.map.push(new CatNode)}for(var t=0;81>t;t++)this.map[t].clean(),0==DataManage.instance().getStatusByIndex(t)&&(this.map[t]._isUsed=!0)},t.prototype.findRound=function(t){var e=[],n=Util.getPointByIndex(t),i=n.y,a=n.x,r=a-1;r>=0&&0==this.map[Util.getIndexByPoint(new egret.Point(r,i))]._isUsed&&e.push(Util.getIndexByPoint(new egret.Point(r,i)));var o=a+1;8>=o&&0==this.map[Util.getIndexByPoint(new egret.Point(o,i))]._isUsed&&e.push(Util.getIndexByPoint(new egret.Point(o,i)));var s=i-1;s>=0&&0==this.map[Util.getIndexByPoint(new egret.Point(a,s))]._isUsed&&e.push(Util.getIndexByPoint(new egret.Point(a,s)));var l=i+1;return 8>=l&&0==this.map[Util.getIndexByPoint(new egret.Point(a,l))]._isUsed&&e.push(Util.getIndexByPoint(new egret.Point(a,l))),i%2!=0?(s>=0&&8>=o&&0==this.map[Util.getIndexByPoint(new egret.Point(o,s))]._isUsed&&e.push(Util.getIndexByPoint(new egret.Point(o,s))),8>=l&&8>=o&&0==this.map[Util.getIndexByPoint(new egret.Point(o,l))]._isUsed&&e.push(Util.getIndexByPoint(new egret.Point(o,l)))):(s>=0&&r>=0&&0==this.map[Util.getIndexByPoint(new egret.Point(r,s))]._isUsed&&e.push(Util.getIndexByPoint(new egret.Point(r,s))),8>=l&&r>=0&&0==this.map[Util.getIndexByPoint(new egret.Point(r,l))]._isUsed&&e.push(Util.getIndexByPoint(new egret.Point(r,l)))),e=e.sort()},t}();__reflect(CatAi.prototype,"CatAi");var CatNode=function(){function t(){this.preIndex=-1,this._isUsed=!1}return t.prototype.clean=function(){this._isUsed=!1,this.preIndex=-1},t}();__reflect(CatNode.prototype,"CatNode");var DataManage=function(){function t(){if(this.stepNum=0,this._catDefaultIndex=40,this._isS=!1,this.before=this._catDefaultIndex,this.tileNum=81,this._tileDatas=[],this._catIndex=0,!t._isInit)throw new Error("Error!");this._catAI=new CatAi,this.createDate()}return t.prototype.setberfore=function(t){this.before=t},t.prototype.getberfore=function(){return this.before},t.instance=function(){return t._dataManage||(t._isInit=!0,t._dataManage=new t,t._isInit=!1),t._dataManage},t.prototype.createDate=function(){for(var t=0;t<this.tileNum;t++)this._tileDatas.push(!0)},t.prototype.init_tileDatas=function(){this._catDefaultIndex=40,t.catIsmc=!0;for(var e=0;e<this.tileNum;e++)this._tileDatas[e]=!0},t.prototype.selectTile=function(){for(var t=Math.floor(5*Math.random()+20),e=0;t>e;e++){var n=Math.floor(Math.random()*this.tileNum);this._tileDatas[n]=!1}this._tileDatas[40]=!0},t.prototype.closeTileByIndex=function(t){this._tileDatas[t]=!1},t.prototype.getStatusByIndex=function(t){return this._tileDatas[t]},t.prototype.createCatPoint=function(){this._catIndex=40},t.prototype.getCatIndex=function(){return this._catIndex},t.prototype.isHaveNextPointByCat=function(){if(this._catAI.isExit(this._catIndex))return this._isS=!1,!1;var e=this._catAI.findNextPoint(this._catIndex);return console.log(e),null==e?(t.catIsmc=!1,t.instance().setberfore(this._catIndex),this._catIndex=this._catAI.getNear(this._catIndex),this._catIndex?!0:(this._isS=!0,!1)):(this._catIndex=e,!0)},t._isInit=!1,t.catIsmc=!0,t}();__reflect(DataManage.prototype,"DataManage");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Tile=function(t){function e(e){var n=t.call(this)||this;return n.index=0,n._isOpen=!0,n._redSkin=new egret.Bitmap,n._redSkin.texture=e.getTexture("grid_yellow"),n._blackSkin=new egret.Bitmap,n._blackSkin.texture=e.getTexture("grid_white"),n._blackSkin.width=50,n._blackSkin.height=50,n._redSkin.width=50,n._redSkin.height=50,n.touchEnabled=!0,n.addChild(n._blackSkin),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onclick,n),n}return __extends(e,t),e.prototype.getStatus=function(){return this._isOpen},e.prototype.open=function(){this._isOpen||(this._isOpen=!0,this.removeChild(this._redSkin),this.addChild(this._blackSkin))},e.prototype.close=function(){this._isOpen&&(this._isOpen=!1,this.removeChild(this._blackSkin),this.addChild(this._redSkin))},e.prototype.onclick=function(){var t=RES.getRes("click1_mp3");if(t.play(0,1).volume=1,this._isOpen){var e=new GameEvent(GameEvent.OPEN_TILE);e.opren_tile_index=this.index,this.dispatchEvent(e)}this.close()},e}(egret.Sprite);__reflect(Tile.prototype,"Tile");var BackGroundPanel=function(t){function e(e,n){var i=t.call(this)||this;return i.texture=n.getTexture("bg"),e.addChild(i),i}return __extends(e,t),e}(egret.Bitmap);__reflect(BackGroundPanel.prototype,"BackGroundPanel");var GameOverButtonPanel=function(t){function e(e){var n=t.call(this)||this;n._reStartBtn=new egret.Sprite,n._reStartBtn.width=200,n._reStartBtn.height=103;var i=new egret.Bitmap;return i.texture=e.getTexture("btn_replay"),n._reStartBtn.addChild(i),n._reStartBtn.touchEnabled=!0,n.addChild(n._reStartBtn),n._reStartBtn.x=(egret.MainContext.instance.stage.stageWidth-n.width)/2,n._reStartBtn.y=egret.MainContext.instance.stage.stageHeight-500,n}return __extends(e,t),e}(egret.Sprite);__reflect(GameOverButtonPanel.prototype,"GameOverButtonPanel");var GameOverPanelF=function(t){function e(e){var n=t.call(this)||this,i=new egret.Bitmap;i.texture=e.getTexture("end_tip_fail"),n.addChild(i),n.width=448,n.height=361,n.x=(egret.MainContext.instance.stage.stageWidth-n.width)/2,n.y=(egret.MainContext.instance.stage.stageHeight-n.height)/2;var a=new egret.TextField;return a.text="你失败了!",a.size=50,a.bold=!0,a.y=20,a.textColor=16777215,a.stroke=3,a.strokeColor=255,a.width=448,a.height=361,a.verticalAlign=egret.VerticalAlign.MIDDLE,a.textAlign=egret.HorizontalAlign.CENTER,n.addChild(a),n}return __extends(e,t),e}(egret.Sprite);__reflect(GameOverPanelF.prototype,"GameOverPanelF");var GameOverPanelS=function(t){function e(e){var n=t.call(this)||this,i=new egret.Bitmap;i.texture=e.getTexture("end_tip_success"),n.addChild(i),n.width=448,n.height=338,n.x=(egret.MainContext.instance.stage.stageWidth-n.width)/2,n.y=(egret.MainContext.instance.stage.stageHeight-n.height)/2;var a=new egret.TextField;return a.text="你成功了",a.width=448,a.height=338,a.textColor=16777215,a.size=60,a.y=20,a.bold=!0,a.stroke=4,a.strokeColor=0,a.textAlign=egret.HorizontalAlign.CENTER,a.verticalAlign=egret.VerticalAlign.MIDDLE,n.addChild(a),n}return __extends(e,t),e}(egret.Sprite);__reflect(GameOverPanelS.prototype,"GameOverPanelS");var StartGmaePanel=function(t){function e(e){var n=t.call(this)||this,i=new egret.Bitmap;i.texture=e.getTexture("cat_start_bg");var a=new egret.Bitmap;return a.texture=e.getTexture("btn_start"),n.width=400,n.height=500,a.touchEnabled=!0,a.x=100,a.y=500,n.x=(egret.MainContext.instance.stage.stageWidth-n.width)/2,n.y=(egret.MainContext.instance.stage.stageHeight-n.height)/2,n.addChild(i),n.addChild(a),n}return __extends(e,t),e}(egret.Sprite);__reflect(StartGmaePanel.prototype,"StartGmaePanel");var ViewManage=function(t){function e(e,n){var i=t.call(this)||this;return i._tiles=[],i._rootView=e,i._textures=n,i._backGroundPanel=new BackGroundPanel(e,n),i._startGmaePanel=new StartGmaePanel(n),i._startGmaePanel.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onStarGameClick,i),i._gameOverPanelS=new GameOverPanelS(n),i._gameOverPanelF=new GameOverPanelF(n),i._gameOverButtonPanel=new GameOverButtonPanel(n),i._gameOverButtonPanel._reStartBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onResetGameClick,i),i.showStartGameView(),i}return __extends(e,t),e.prototype.createCat=function(){this._cat=new Cat},e.prototype.showStartGameView=function(){this._startGmaePanel&&this._rootView.addChild(this._startGmaePanel)},e.prototype.onStarGameClick=function(){this._rootView.removeChild(this._startGmaePanel),this._startGmaePanel.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onStarGameClick,this),this.createTiles(),this.showTile(),this.createCat();var t=new GameEvent(GameEvent.START_GAME);this.dispatchEvent(t)},e.prototype.onResetGameClick=function(){this._gameOverPanelS.parent?(this._rootView.removeChild(this._gameOverPanelS),this._rootView.removeChild(this._gameOverButtonPanel._reStartBtn)):(this._rootView.removeChild(this._gameOverButtonPanel._reStartBtn),this._rootView.removeChild(this._gameOverPanelF));var t=new GameEvent(GameEvent.START_GAME);this.dispatchEvent(t)},e.prototype.createTiles=function(){for(var t=81,e=0;t>e;e++){var n=new Tile(this._textures);n.index=e,this._tiles.push(n),n.addEventListener(GameEvent.OPEN_TILE,this.onOpenTile,this)}},e.prototype.onOpenTile=function(t){this.dispatchEvent(t)},e.prototype.showTile=function(){for(var t=81,e=0;t>e;e++){var n=Util.getPointXYByIndex(this._tiles[e].index);this._tiles[e].x=n.x,this._tiles[e].y=n.y,this._rootView.addChild(this._tiles[e])}},e.prototype.updateAll=function(){for(var t=81,e=0;t>e;e++)DataManage.instance().getStatusByIndex(e)?this._tiles[e].open():this._tiles[e].close();null==this._cat.parent&&(console.log("created cat"),this._rootView.addChild(this._cat)),this._cat.init(),this.update()},e.prototype.update=function(){var t=Util.getPointXYByIndex(DataManage.instance().getCatIndex()),e=DataManage.instance().getberfore();this._tiles[e].touchEnabled=!0,this._cat.x=t.x,this._cat.y=t.y-55,this._tiles[DataManage.instance().getCatIndex()].touchEnabled=!1,this._cat.isnormalmc=DataManage.catIsmc},e.prototype.showGameOverView=function(t){if(t){this._rootView.addChild(this._gameOverPanelS);var e=RES.getRes("shengli_mp3");e.play(0,1).volume=.2}else{this._rootView.addChild(this._gameOverPanelF);var e=RES.getRes("shibai_mp3");e.play(0,1).volume=.2}this._rootView.addChild(this._gameOverButtonPanel._reStartBtn)},e}(egret.EventDispatcher);__reflect(ViewManage.prototype,"ViewManage");